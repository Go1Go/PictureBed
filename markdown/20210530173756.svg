<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="929px" preserveAspectRatio="none" style="width:1733px;height:929px;" version="1.1" viewBox="0 0 1733 929" width="1733px" zoomAndPan="magnify"><defs><filter height="300%" id="f1soonvp4b7m8a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="83" x2="83" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="357" x2="357" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="767.5" x2="767.5" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="878.5" x2="878.5" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1019.5" x2="1019.5" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1275" x2="1275" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1467" x2="1467" y1="40.4883" y2="885.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1589" x2="1589" y1="40.4883" y2="885.9414"/><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="25.5352">JobSchedulerService</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="5" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="905.4766">JobSchedulerService</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="118" x="296" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="303" y="25.5352">TimeController</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="118" x="296" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="303" y="905.4766">TimeController</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="714.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="721.5" y="25.5352">AlarmService</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="714.5" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="721.5" y="905.4766">AlarmService</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="90" x="831.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="838.5" y="25.5352">JobHandler</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="90" x="831.5" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="838.5" y="905.4766">JobHandler</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="164" x="935.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="942.5" y="25.5352">ConCurrencyManager</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="164" x="935.5" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="942.5" y="905.4766">ConCurrencyManager</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="1204" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1211" y="25.5352">JobServiceContext</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="1204" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1211" y="905.4766">JobServiceContext</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="131" x="1400" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1407" y="25.5352">JobServiceEngine</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="131" x="1400" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1407" y="905.4766">JobServiceEngine</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="84" x="1545" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1552" y="25.5352">JobService</text><rect fill="#FEFECE" filter="url(#f1soonvp4b7m8a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="84" x="1545" y="884.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1552" y="905.4766">JobService</text><polygon fill="#A80036" points="345,67.7988,355,71.7988,345,75.7988,349,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83" x2="351" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="90" y="67.0566">maybeStartTrackingJobLocked(job, null)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="399" y1="101.1094" y2="101.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="399" x2="399" y1="101.1094" y2="114.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="399" y1="114.1094" y2="114.1094"/><polygon fill="#A80036" points="368,110.1094,358,114.1094,368,118.1094,364,114.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="364" y="96.3672">maybeUpdateDeadlineAlarmLocked(time, ws)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="399" y1="143.4199" y2="143.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="399" x2="399" y1="143.4199" y2="156.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="399" y1="156.4199" y2="156.4199"/><polygon fill="#A80036" points="368,152.4199,358,156.4199,368,160.4199,364,156.4199" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="364" y="138.6777">setDeadlineExpiredAlarmLocked(time, ws)</text><path d="M302,169.4199 L302,194.4199 L822,194.4199 L822,179.4199 L812,169.4199 L302,169.4199 " fill="#FBFB77" filter="url(#f1soonvp4b7m8a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M812,169.4199 L812,179.4199 L822,179.4199 L812,169.4199 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="370.75" y="186.9883">AlarmManager.WINDOW_HEURISTIC 表示是非精确的定时任务</text><polygon fill="#A80036" points="756,236.3516,766,240.3516,756,244.3516,760,240.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="762" y1="240.3516" y2="240.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="364" y="220.2988">set(alarmType, alarmTimeElapsed,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="383" x="368" y="235.6094">AlarmManager.WINDOW_HEURISTIC, 0, tag, listener, null, ws)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="768" x2="810" y1="269.6621" y2="269.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="810" x2="810" y1="269.6621" y2="282.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="769" x2="810" y1="282.6621" y2="282.6621"/><polygon fill="#A80036" points="779,278.6621,769,282.6621,779,286.6621,775,282.6621" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="775" y="264.9199">setImpl(...)</text><polygon fill="#A80036" points="368,307.9727,358,311.9727,368,315.9727,364,311.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="362" x2="767" y1="311.9727" y2="311.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="374" y="307.2305">onAlarm()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="399" y1="341.2832" y2="341.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="399" x2="399" y1="341.2832" y2="354.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358" x2="399" y1="354.2832" y2="354.2832"/><polygon fill="#A80036" points="368,350.2832,358,354.2832,368,358.2832,364,354.2832" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="364" y="336.541">checkExpiredDeadlinesAndResetAlarm()</text><polygon fill="#A80036" points="94,379.5938,84,383.5938,94,387.5938,90,383.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88" x2="356" y1="383.5938" y2="383.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="100" y="378.8516">onRunJobNow(job)</text><polygon fill="#A80036" points="866.5,408.9043,876.5,412.9043,866.5,416.9043,870.5,412.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83" x2="872.5" y1="412.9043" y2="412.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="90" y="408.1621">obtainMessage(MSG_JOB_EXPIRED, jobStatus).sendToTarget()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="878.5" x2="920.5" y1="442.2148" y2="442.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="920.5" x2="920.5" y1="442.2148" y2="455.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="879.5" x2="920.5" y1="455.2148" y2="455.2148"/><polygon fill="#A80036" points="889.5,451.2148,879.5,455.2148,889.5,459.2148,885.5,455.2148" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="885.5" y="437.4727">handleMessage()</text><polygon fill="#A80036" points="94,480.5254,84,484.5254,94,488.5254,90,484.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88" x2="877.5" y1="484.5254" y2="484.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="100" y="479.7832">maybeRunPendingJobsLocked()</text><polygon fill="#A80036" points="1007.5,509.8359,1017.5,513.8359,1007.5,517.8359,1011.5,513.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83" x2="1013.5" y1="513.8359" y2="513.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="90" y="509.0938">assignJobsToContextsLocked()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1019.5" x2="1061.5" y1="543.1465" y2="543.1465"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1061.5" x2="1061.5" y1="543.1465" y2="556.1465"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1061.5" y1="556.1465" y2="556.1465"/><polygon fill="#A80036" points="1030.5,552.1465,1020.5,556.1465,1030.5,560.1465,1026.5,556.1465" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="1026.5" y="538.4043">assignJobsToContextsInternalLocked()</text><polygon fill="#A80036" points="1263.5,581.457,1273.5,585.457,1263.5,589.457,1267.5,585.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019.5" x2="1269.5" y1="585.457" y2="585.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="1026.5" y="580.7148">executeRunnableJob(pendingJob)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1275.5" x2="1317.5" y1="614.7676" y2="614.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1317.5" x2="1317.5" y1="614.7676" y2="627.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1276.5" x2="1317.5" y1="627.7676" y2="627.7676"/><polygon fill="#A80036" points="1286.5,623.7676,1276.5,627.7676,1286.5,631.7676,1282.5,627.7676" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1282.5" y="610.0254">bindServiceAsuser(...)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1275.5" x2="1317.5" y1="657.0781" y2="657.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1317.5" x2="1317.5" y1="657.0781" y2="670.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1276.5" x2="1317.5" y1="670.0781" y2="670.0781"/><polygon fill="#A80036" points="1286.5,666.0781,1276.5,670.0781,1286.5,674.0781,1282.5,670.0781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1282.5" y="652.3359">onServiceConnected()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1275.5" x2="1317.5" y1="699.3887" y2="699.3887"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1317.5" x2="1317.5" y1="699.3887" y2="712.3887"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1276.5" x2="1317.5" y1="712.3887" y2="712.3887"/><polygon fill="#A80036" points="1286.5,708.3887,1276.5,712.3887,1286.5,716.3887,1282.5,712.3887" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1282.5" y="694.6465">handleServiceBoundLocked()</text><polygon fill="#A80036" points="1455.5,753.0098,1465.5,757.0098,1455.5,761.0098,1459.5,757.0098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1275.5" x2="1461.5" y1="757.0098" y2="757.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="1282.5" y="736.957">startJob()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="1286.5" y="752.2676">binder 调用</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1467.5" x2="1509.5" y1="786.3203" y2="786.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1509.5" x2="1509.5" y1="786.3203" y2="799.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1468.5" x2="1509.5" y1="799.3203" y2="799.3203"/><polygon fill="#A80036" points="1478.5,795.3203,1468.5,799.3203,1478.5,803.3203,1474.5,799.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="1474.5" y="781.5781">onStartJob()</text><polygon fill="#A80036" points="1577,824.6309,1587,828.6309,1577,832.6309,1581,828.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1467.5" x2="1583" y1="828.6309" y2="828.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1474.5" y="823.8887">onStrartJob()</text><path d="M1450,841.6309 L1450,866.6309 L1724,866.6309 L1724,851.6309 L1714,841.6309 L1450,841.6309 " fill="#FBFB77" filter="url(#f1soonvp4b7m8a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1714,841.6309 L1714,851.6309 L1724,851.6309 L1714,841.6309 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1456" y="859.1992">自定义的 jobService 需要实现 onStartJob()</text><!--MD5=[1338b8fe46f110b6b744ab7547aec68b]
@startuml jobservice条件触发
JobSchedulerService -> TimeController: maybeStartTrackingJobLocked(job, null)
TimeController -> TimeController: maybeUpdateDeadlineAlarmLocked(time, ws)
TimeController -> TimeController: setDeadlineExpiredAlarmLocked(time, ws)
note over TimeController, AlarmService: AlarmManager.WINDOW_HEURISTIC 表示是非精确的定时任务
TimeController -> AlarmService:  set(alarmType, alarmTimeElapsed, \n AlarmManager.WINDOW_HEURISTIC, 0, tag, listener, null, ws)
AlarmService -> AlarmService: setImpl(...)
AlarmService -> TimeController: onAlarm()
TimeController -> TimeController: checkExpiredDeadlinesAndResetAlarm()
TimeController -> JobSchedulerService: onRunJobNow(job)
JobSchedulerService -> JobHandler: obtainMessage(MSG_JOB_EXPIRED, jobStatus).sendToTarget()
JobHandler -> JobHandler: handleMessage()
JobHandler -> JobSchedulerService: maybeRunPendingJobsLocked()
JobSchedulerService -> ConCurrencyManager: assignJobsToContextsLocked()
ConCurrencyManager -> ConCurrencyManager: assignJobsToContextsInternalLocked()
ConCurrencyManager -> JobServiceContext: executeRunnableJob(pendingJob)
JobServiceContext -> JobServiceContext: bindServiceAsuser(...)
JobServiceContext -> JobServiceContext: onServiceConnected()
JobServiceContext -> JobServiceContext: handleServiceBoundLocked()
JobServiceContext -> JobServiceEngine: startJob() \n binder 调用
JobServiceEngine -> JobServiceEngine: onStartJob()
JobServiceEngine -> JobService: onStrartJob()
note over JobService: 自定义的 jobService 需要实现 onStartJob()
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>