<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="540px" preserveAspectRatio="none" style="width:1242px;height:540px;" version="1.1" viewBox="0 0 1242 540" width="1242px" zoomAndPan="magnify"><defs><filter height="300%" id="fl8bavj0e6fkm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fl8bavj0e6fkm)" height="204.8633" style="stroke:#000000;stroke-width:2.0;" width="842" x="386.5" y="274.6621"/><rect fill="#FFFFFF" height="145.2422" style="stroke:none;stroke-width:1.0;" width="842" x="386.5" y="334.2832"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="41" x2="41" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="182.5" x2="182.5" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="315.5" x2="315.5" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="474.5" x2="474.5" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="757.5" x2="757.5" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="890.5" x2="890.5" y1="40.4883" y2="496.5254"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1146.5" x2="1146.5" y1="40.4883" y2="496.5254"/><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="69" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="12" y="25.5352">Context</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="69" x="5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="12" y="516.0605">Context</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="104" x="128.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="135.5" y="25.5352">JobScheduler</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="104" x="128.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="135.5" y="516.0605">JobScheduler</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="246.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="253.5" y="25.5352">JobSchedulerImpl</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="246.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="253.5" y="516.0605">JobSchedulerImpl</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="396.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="403.5" y="25.5352">JobSchedulerService</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="396.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="403.5" y="516.0605">JobSchedulerService</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="78" x="716.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="723.5" y="25.5352">JobStatus</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="78" x="716.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="723.5" y="516.0605">JobStatus</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="161" x="808.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="815.5" y="25.5352">ConcurrencyManager</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="161" x="808.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="815.5" y="516.0605">ConcurrencyManager</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="1075.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1082.5" y="25.5352">JobServiceContext</text><rect fill="#FEFECE" filter="url(#fl8bavj0e6fkm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="1075.5" y="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1082.5" y="516.0605">JobServiceContext</text><polygon fill="#A80036" points="170.5,67.7988,180.5,71.7988,170.5,75.7988,174.5,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="41.5" x2="176.5" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="48.5" y="67.0566">getSystemService()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="224.5" y1="101.1094" y2="101.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="224.5" x2="224.5" y1="101.1094" y2="114.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="183.5" x2="224.5" y1="114.1094" y2="114.1094"/><polygon fill="#A80036" points="193.5,110.1094,183.5,114.1094,193.5,118.1094,189.5,114.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="189.5" y="96.3672">schedule()</text><polygon fill="#A80036" points="303.5,139.4199,313.5,143.4199,303.5,147.4199,307.5,143.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="309.5" y1="143.4199" y2="143.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="189.5" y="138.6777">scheudle()</text><polygon fill="#A80036" points="462.5,184.041,472.5,188.041,462.5,192.041,466.5,188.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315.5" x2="468.5" y1="188.041" y2="188.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="322.5" y="167.9883">scheduleAsPackage()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="326.5" y="183.2988">binder 调用</text><polygon fill="#A80036" points="745.5,213.3516,755.5,217.3516,745.5,221.3516,749.5,217.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="751.5" y1="217.3516" y2="217.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="481.5" y="212.6094">createFromJobInfo()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="516.5" y1="246.6621" y2="246.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="516.5" x2="516.5" y1="246.6621" y2="259.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475.5" x2="516.5" y1="259.6621" y2="259.6621"/><polygon fill="#A80036" points="485.5,255.6621,475.5,259.6621,485.5,263.6621,481.5,259.6621" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="481.5" y="241.9199">isReadyToBeExecutedLocked</text><path d="M386.5,274.6621 L448.5,274.6621 L448.5,281.6621 L438.5,291.6621 L386.5,291.6621 L386.5,274.6621 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="204.8633" style="stroke:#000000;stroke-width:2.0;" width="842" x="386.5" y="274.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="401.5" y="288.2305">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="74" x="463.5" y="287.2969">[可以立即执行]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="516.5" y1="313.2832" y2="313.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="516.5" x2="516.5" y1="313.2832" y2="326.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475.5" x2="516.5" y1="326.2832" y2="326.2832"/><polygon fill="#A80036" points="485.5,322.2832,475.5,326.2832,485.5,330.2832,481.5,326.2832" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="481.5" y="308.541">evaluateControllerStatesLocked(jobStatus);</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="386.5" x2="1228.5" y1="335.2832" y2="335.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="516.5" y1="357.5938" y2="357.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="516.5" x2="516.5" y1="357.5938" y2="370.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475.5" x2="516.5" y1="370.5938" y2="370.5938"/><polygon fill="#A80036" points="485.5,366.5938,475.5,370.5938,485.5,374.5938,481.5,370.5938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="481.5" y="352.8516">maybeRunPendingJobsLocked()</text><polygon fill="#A80036" points="879,395.9043,889,399.9043,879,403.9043,883,399.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="885" y1="399.9043" y2="399.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="481.5" y="395.1621">assignJobsToContextsLocked()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891" x2="933" y1="429.2148" y2="429.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933" x2="933" y1="429.2148" y2="442.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892" x2="933" y1="442.2148" y2="442.2148"/><polygon fill="#A80036" points="902,438.2148,892,442.2148,902,446.2148,898,442.2148" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="898" y="424.4727">assignJobsToContextsInternalLocked()</text><polygon fill="#A80036" points="1135,467.5254,1145,471.5254,1135,475.5254,1139,471.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891" x2="1141" y1="471.5254" y2="471.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="898" y="466.7832">executeRunnableJob(JobStatus job)</text><!--MD5=[15e34dd99f96f6a3c72e4c04b120661b]
@startuml jobservice客户端调用
Context -> JobScheduler: getSystemService()
JobScheduler -> JobScheduler: schedule() 
JobScheduler -> JobSchedulerImpl: scheudle()
JobSchedulerImpl -> JobSchedulerService: scheduleAsPackage() \n binder 调用
JobSchedulerService -> JobStatus: createFromJobInfo()
JobSchedulerService -> JobSchedulerService: isReadyToBeExecutedLocked
alt 可以立即执行
    JobSchedulerService -> JobSchedulerService: evaluateControllerStatesLocked(jobStatus);
else
    JobSchedulerService -> JobSchedulerService: maybeRunPendingJobsLocked()
    JobSchedulerService -> ConcurrencyManager: assignJobsToContextsLocked()
    ConcurrencyManager -> ConcurrencyManager: assignJobsToContextsInternalLocked()
    ConcurrencyManager -> JobServiceContext: executeRunnableJob(JobStatus job)
end
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>